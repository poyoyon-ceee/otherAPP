# PWA自動生成ツール 仕様書

## 1. 概要

WebアプリのHTMLファイルを入力すると、PWA化に必要なファイル（manifest.json、service-worker.js、start-server.bat）を自動生成するWebアプリケーション。

## 2. 対応環境

### 2.1 ブラウザ要件
- **Google Chrome**: 136.0.7103.116以降
- **Microsoft Edge**: 136.0.3240.92以降
- **互換性**: 古いブラウザとの互換性を考慮すること

### 2.2 システム要件
- **解像度**: 1920×1080
- **動作環境**: 完全オフライン
- **フォント**: BIZ UDPゴシック（なければ一般的なビジネスフォント）

### 2.3 制約事項
- ネットワークから遮断された環境での使用を前提
- 外部リソースへのアクセス禁止
- 必要なライブラリはすべてアプリケーションに組み込み

## 3. 機能要件

### 3.1 主要機能
1. **HTML解析機能**
   - アップロードされたHTMLファイルからタイトル、説明文を自動抽出
   - meta情報の解析
   
2. **PWAファイル生成機能**
   - manifest.json生成
   - service-worker.js生成
   - start-server.bat生成

3. **プレビュー機能**
   - 生成されたコードの表示
   - リアルタイム編集機能

4. **エクスポート機能**
   - 個別ファイルのダウンロード
   - 一括ダウンロード（ZIP形式）
   - クリップボードコピー

## 4. 画面仕様

### 4.1 レイアウト構成
```
┌─────────────────────────────────────┐
│              ヘッダー               │
├─────────────────────────────────────┤
│                                     │
│          入力エリア                 │
│  ┌─────────────────────────────┐    │
│  │     HTMLファイル入力欄      │    │
│  └─────────────────────────────┘    │
│  ┌─────────────────────────────┐    │
│  │   ポート番号入力欄(8002)    │    │
│  └─────────────────────────────┘    │
│  ┌─────────────────────────────┐    │
│  │       作成ボタン            │    │
│  └─────────────────────────────┘    │
│                                     │
├─────────────────────────────────────┤
│                                     │
│          出力エリア                 │
│  ┌─────────────────────────────┐    │
│  │     manifest.jsonタブ       │    │
│  │  ┌─────────────────────────┐ │    │
│  │  │                         │ │    │
│  │  │     コード表示エリア    │ │    │
│  │  │                         │ │    │
│  │  └─────────────────────────┘ │    │
│  │  [コピー] [ダウンロード]    │    │
│  └─────────────────────────────┘    │
│                                     │
└─────────────────────────────────────┘
```

### 4.2 入力フィールド詳細

#### HTMLファイル入力欄
- **形式**: ファイルアップロードまたはテキストエリア
- **対応形式**: .html, .htm
- **文字エンコード**: UTF-8（BOM付き推奨）
- **最大サイズ**: 10MB
- **検証項目**:
  - 有効なHTML形式かチェック
  - titleタグの存在確認
  - meta情報の抽出

#### ポート番号入力欄
- **デフォルト値**: 8002
- **範囲**: 1024-65535
- **検証**: 数値のみ入力可能
- **説明**: 開発サーバー用ポート番号

#### 設定オプション（展開可能セクション）
- **アプリ名**: 自動抽出または手動入力
- **アプリ短縮名**: 自動生成または手動入力
- **説明文**: meta descriptionから自動抽出
- **テーマカラー**: カラーピッカーまたは手動入力（デフォルト: #2196F3）
- **背景色**: カラーピッカーまたは手動入力（デフォルト: #ffffff）

## 5. 出力仕様

### 5.1 タブ構成
1. **manifest.jsonタブ**
2. **service-worker.jsタブ**  
3. **start-server.batタブ**
4. **使用方法タブ**

### 5.2 各ファイルの生成仕様

#### manifest.json
```json
{
    "name": "{HTMLのtitleから抽出またはユーザー入力}",
    "short_name": "{nameを短縮または別途指定}",
    "description": "{meta descriptionから抽出}",
    "start_url": "./index.html",
    "display": "standalone",
    "background_color": "{ユーザー指定色}",
    "theme_color": "{ユーザー指定色}",
    "icons": [
        {
            "src": "icons/icon192.png",
            "sizes": "192x192",
            "type": "image/png"
        },
        {
            "src": "icons/icon512.png",
            "sizes": "512x512",
            "type": "image/png"
        }
    ]
}
```

#### service-worker.js
- キャッシュ名は「{アプリ名}-v1.0」形式
- HTMLファイル内のリソース（CSS、JS、画像）を自動検出してキャッシュリストに追加
- オフライン対応機能
- キャッシュ更新機能

#### start-server.bat
```batch
@echo off
SET PYTHON_DIR=%~dp0python-portable
cd /d "%~dp0"
start cmd /k "%PYTHON_DIR%\python.exe" -m http.server {指定ポート番号}
timeout /t 3 >nul
start chrome http://localhost:{指定ポート番号}/
exit
```

### 5.3 操作ボタン仕様

#### 各タブ共通ボタン
- **コピーボタン**: クリップボードにコードをコピー
- **ダウンロードボタン**: 個別ファイルとしてダウンロード

#### 一括操作ボタン
- **全ファイル一括ダウンロード**: ZIPファイルで全ファイルを取得
- **設定リセット**: 入力内容をクリア

## 6. 技術仕様

### 6.1 使用技術
- **フロントエンド**: HTML5, CSS3, JavaScript（ES6+）
- **ファイル処理**: File API, Blob API
- **圧縮**: JSZip（組み込み）
- **パーサー**: DOMParser（HTMLパース用）

### 6.2 HTML解析機能
```javascript
// HTML解析処理例
function parseHTML(htmlContent) {
    const parser = new DOMParser();
    const doc = parser.parseFromString(htmlContent, 'text/html');
    
    return {
        title: doc.querySelector('title')?.textContent || '',
        description: doc.querySelector('meta[name="description"]')?.content || '',
        themeColor: doc.querySelector('meta[name="theme-color"]')?.content || '#2196F3',
        resources: extractResources(doc)
    };
}
```

### 6.3 ファイル構成
```
pwa-generator/
├── index.html (メインアプリケーション)
├── styles/
│   └── app.css
├── scripts/
│   ├── app.js
│   ├── html-parser.js
│   ├── pwa-generator.js
│   └── jszip.min.js
└── icons/
    ├── app-icon192.png
    └── app-icon512.png
```

## 7. エラーハンドリング

### 7.1 入力検証エラー
- HTMLファイル形式不正
- ファイルサイズ超過
- ポート番号範囲外
- 必須項目未入力

### 7.2 生成エラー
- HTMLパース失敗
- リソース抽出失敗
- ファイル生成失敗

### 7.3 エラー表示
- エラーメッセージはモーダルまたはトースト形式で表示
- 詳細なエラー内容を含む
- 解決方法の提案を含む

## 8. ユーザビリティ

### 8.1 操作性
- ドラッグ&ドロップでHTMLファイル追加
- リアルタイムプレビュー
- ワンクリックでのファイル生成
- 直感的なタブ操作

### 8.2 レスポンシブ対応
- 最小解像度: 1366×768
- タブレット表示対応
- 縦画面レイアウト対応

### 8.3 アクセシビリティ
- キーボード操作対応
- スクリーンリーダー対応
- 十分なコントラスト比
- 分かりやすいラベル表示

## 9. 品質要件

### 9.1 パフォーマンス
- ファイル生成時間: 3秒以内
- 画面応答時間: 1秒以内
- メモリ使用量: 100MB以内

### 9.2 互換性
- 古いブラウザでの基本機能動作
- 文字エンコード対応（BOM付きUTF-8）
- 異なるOSでの動作確認

### 9.3 保守性
- モジュール化されたコード構成
- 適切なコメント付与
- 設定値の外部化

## 10. 使用方法タブの内容

### 10.1 手順説明
1. **アイコン準備**
   ```
   icons/フォルダに以下を配置：
   - icon192.png (192×192px)
   - icon512.png (512×512px)
   ```

2. **Python環境準備**
   ```
   同フォルダにpython-portableを配置
   ```

3. **ファイル配置**
   ```
   project-folder/
   ├── index.html (あなたのWebアプリ)
   ├── manifest.json (生成されたファイル)
   ├── service-worker.js (生成されたファイル)
   ├── start-server.bat (生成されたファイル)
   ├── icons/
   │   ├── icon192.png
   │   └── icon512.png
   └── python-portable/
   ```

4. **起動方法**
   ```
   start-server.batをダブルクリック
   ```

### 10.2 注意事項
- HTTPSまたはlocalhost環境でのみPWA機能が有効
- アイコンファイルは必須
- オフライン環境での使用を前提とした設計

## 11. 今後の拡張予定

### 11.1 機能拡張
- 複数HTMLファイル対応
- カスタムアイコン生成機能
- テンプレート機能
- 設定保存機能

### 11.2 対応形式拡張
- React/Vue.jsプロジェクト対応
- TypeScript対応
- WebPアイコン対応

---

**注意事項**:
- 本仕様は完全オフライン環境での使用を前提としています
- セキュリティ要件は別途検討が必要です
- アイコン画像の著作権に注意してください